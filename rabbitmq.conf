# RabbitMQ Configuration for Voenmeh Bot
# Этот файл содержит настройки для стабильной работы с Dramatiq

# Основные настройки
listeners.tcp.default = 5672
management.tcp.port = 15672

# Настройки соединений
heartbeat = 30
frame_max = 131072
channel_max = 2048

# Настройки для стабильности соединений
connection_max = 2048
consumer_timeout = 1800000  # 30 минут в мс

# TCP настройки для лучшей стабильности
tcp_listen_options.backlog = 256
tcp_listen_options.nodelay = true
tcp_listen_options.keepalive = true

# Настройки производительности
vm_memory_high_watermark.relative = 0.6
# Порог свободного места на диске: понижен для dev/однодисковой среды, чтобы контейнер не считался unhealthy из-за низкого диска
disk_free_limit.relative = 1.0

# Настройки логирования
log.console = true
log.console.level = info
log.file = false

# Настройки для стабильности
tcp_listen_options.backlog = 128
tcp_listen_options.nodelay = true

# Настройки для автоматического восстановления
cluster_formation.peer_discovery_backend = classic_config
cluster_formation.classic_config.nodes.1 = rabbit@rabbitmq

# Настройки для мониторинга
management.http_log_dir = /var/log/rabbitmq/management

# Настройки безопасности
loopback_users = none
hipe_compile = false

# RabbitMQ Configuration for Voenmeh Bot
# Этот файл содержит настройки для стабильной работы с Dramatiq

# Основные настройки
listeners.tcp.default = 5672
management.tcp.port = 15672

# Настройки соединений - оптимизированы для стабильности
heartbeat = 30
frame_max = 131072
channel_max = 1024  # Reduced from 2048 to limit resource usage

# Настройки для стабильности соединений - улучшены
connection_max = 1024  # Reduced to prevent connection overload
consumer_timeout = 900000  # 15 минут в мс (reduced from 30min)

# TCP настройки для лучшей стабильности - совместимые с RabbitMQ 3.x
tcp_listen_options.backlog = 256
tcp_listen_options.nodelay = true
tcp_listen_options.keepalive = true
tcp_listen_options.sndbuf = 32768   # Send buffer size
tcp_listen_options.recbuf = 32768   # Receive buffer size

# Настройки производительности
vm_memory_high_watermark.relative = 0.6
# Порог свободного места на диске: понижен для dev/однодисковой среды, чтобы контейнер не считался unhealthy из-за низкого диска
disk_free_limit.relative = 1.0

# Настройки логирования
log.console = true
log.console.level = info
log.file = false

# Настройки для стабильности (удалены дубликаты)

# Настройки для автоматического восстановления
cluster_formation.peer_discovery_backend = classic_config
cluster_formation.classic_config.nodes.1 = rabbit@rabbitmq

# Настройки для мониторинга
management.http_log_dir = /var/log/rabbitmq/management

# Настройки безопасности
loopback_users = none
hipe_compile = false
